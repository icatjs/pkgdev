"use strict";function var2value(e,r){var t=e.match(/<\%\=\w+\%>/g);return t&&t.forEach(function(t){var a=t.replace(/^<\%\=|\%>$/g,""),n=r[a]||"",c=new RegExp("<\\%\\="+a+"\\%>","g");e=e.replace(c,n)}),e}function encrypt(e,r){for(var t=[],a=e.length,n=r.length,c=0;a>c;c++){var f=e.charCodeAt(c)^r.charCodeAt(c%n);t.push(f)}return t.join("^")}var Stream=require("stream"),Path=require("path"),cfg=require("./package.json"),StringDecoder=require("string_decoder").StringDecoder,fs=require("fs"),tag=["w","i","d","g","e","t"].join(""),tagCla=cfg.name+"-wrap";module.exports={file:function(){var e=new Stream.Transform({objectMode:!0});return e._transform=function(e,r,t){var a=new StringDecoder("utf8"),n=a.write(e.contents),c="",f="";if(cfg.tpl){try{c=fs.readFileSync(cfg.tpl,"utf8")}catch(g){}c=c.replace(/(\\f|\\n|\\r|\\t|\\v)+/g,"").replace(/\s+/g," "),c=c?"<"+tag+' class="'+tagCla+'">'+c+"</"+tag+">":c,cfg.template=c.replace(/(['"])/g,"\\$1")}if(cfg.style){try{f=fs.readFileSync(cfg.style,"utf8")}catch(g){}f=f.replace(/(\\f|\\n|\\r|\\t|\\v)+/g,"").replace(/\s+/g," "),cfg.css=encrypt(f,"vkme:valleykiddy@gmail.com")}n=var2value(n,cfg),e.contents=new Buffer(n,"utf-8"),t(null,e)},e},wrap:function(e,r,t){var a=new Stream.Transform({objectMode:!0});return a._transform=function(e,r,t){var a=new StringDecoder("utf8"),n=a.write(e.contents);n=tag+"."+tagCla+"{"+n+"}",e.contents=new Buffer(n,"utf-8"),t(null,e)},a}};